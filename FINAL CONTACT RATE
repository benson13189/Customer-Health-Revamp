select 
distinct(sfdc_account.store_id__c) as "Stores",
count(sfdc_account.id) as "Count",
case
    when sfdc_account.customer_health_score__c is not null then sfdc_account.customer_health_score__c
    when sfdc_account.customer_health_score__c is null then 'No Current CHO' end as "Current CHO",
case
    when "Count" <= '1' then 3
    when "Count" = '2' then 2
    when "Count" = '3' then 1
    when "Count" >= '4' then 0
    end as "New CHO"

from
"PROD"."SALESFORCE"."ACCOUNT" as sfdc_account
    join "PROD"."SALESFORCE"."CASE" sfdc_case
        on sfdc_account.id = sfdc_case.accountid
   
where
sfdc_case.recordtypeid = '0122M000001cuS8QAI' and
sfdc_case.createddate >= dateadd('day',-30,getdate())
group by "Stores","Current CHO"
      
